## 操作系统中不同的锁

### 信号量 Semaphore

信号量分为二元信号量和多元信号量，二元信号量就是信号量只有两个状态，要么被占用，要么空闲；多元信号量则允许同时被N个线程占用，超出N个外的占用请求将被阻塞。比如常见的生产者和消费者，就是多元信号量的一种，生产者可以生产多个元素，消费者可以消费的元素必须小于生产者生产的元素个数。
信号量是系统级别的，即同一个信号量可以被不同的进程访问。

### 互斥量 Mutex

和二元信号量类似，唯一不同的是，**互斥量的获取和释放必须在同一个线程中进行**，如果一个线程去释放一个并不是它占有的互斥量是无效的。信号量是可以由其他线程释放的。

### 临界区 Critical Section

把临界区锁的获取称为进入临界区，而把临界区锁的释放称为离开临界区。临界区是“进程级别的”，它只在本进程的所有线程中可见，哪个线程获取锁，就由哪个线程释放，这点和互斥量类似。

### 读写锁 Read-Write Lock

适用于一个特定的场合。如对于一段线程间访问的数据，如果程序大部分时间都是在读取，只有很少的时间才会写入，使用前面几种锁时，每次读取也是需要申请锁的，这时其他线程
就无法对此段数据进行读取，但多线程的读取操作是没有同步问题的，此时设置锁就会影响程序性能，

对于一个读写锁，有两种获取方式：**共享和独占**。如果当前读写锁处于空闲状态，多个线程以共享方式访问该读写锁时都可以成功，如果一个线程以独占的方式访问该读写锁，
它会等待所有的共享访问都结束才能访问成功。读写锁被独占访问的时候，再次共享和独占请求访问该锁都会进入等待状态。

### 条件变量 Condition Variable

条件变量相当于一种通知机制，多个线程可以设置等待该条件变量，一旦另外的线程设置了该条件变量（相当于唤醒了该条件变量），这些等待的线程就可以继续执行了。

## 信号量和互斥量的区别

程序的可重入：一个程序因为操作系统中断被挂起，当再次进入程序执行的时候可以依旧正确运行。表达一个函数可重入的时候必须包含静态变量和全局变量。
对于那些不可重入的多线程，必须让多个线程进行同步操作。所谓同步，指的是一个线程在访问资源尚未结束的时候，其他线程不可以随意访问并修改数据。

· Mutex是一把钥匙，一个人拿了钥匙进入一个房间，出来的时候把钥匙交给队列的第一个（锁的获取和释放均由同一个线程进行），一般的用法是 **用于串行化对临界区代码的访问，**保证这段代码不会被并发执行。\
· Semaphore是一间可以容纳N个人的房间，如果人不满就可以进去，如果人满了，就要等待有人出来，对于N=1, 称为binary semaphore,一般用于限制对于某一资源的同时访问，有的系统中二元信号量和互斥量是没有差异的。\
· 信号量可以设置计数器，而互斥锁只有0和1 的关系

