## B/B+ Tree

//https://zhuanlan.zhihu.com/p/54102723

二叉搜索树的查询效率已经足够高了，但是由于磁盘IO次数的限制，树不能太高（最坏情况磁盘IO次数为树的高度），所以要把树的高度减小。多路平衡树就出现了。

## B树

每个节点最多包含k个孩子，k被称为B树的阶数。k的大小取决于**磁盘页的大小**。

m阶B树的特性：

· 根节点至少有两个节点\
· 每个中间结点都包含k-1个元素和k个孩子，其中  m/2<= k<= m\
· 每个叶子结点都包含k-1个元素，其中 m/2 <=k <=m\
· 所有叶子节点位于同一层\
· 每个节点元素从小到大排列，节点中的k-1个元素正好是k个孩子包含的元素的值域分划。

插入操作：

以3阶B树为例：

                 9
             /       \
           2  6        12
          /  |  \    /    \
        1   3 5   8 11  13 15
 
 插入4,  3,4,5已经三个元素，不符合要求，需要分解，2,4,6也是三个元素，需要分解，4,9两个元素可以。
 
               4     9
             /    |    \
           2      6     12
          / \    / \    / \
         1  3    5  8  11  13 15
 
 删除操作：
 
 比如删除11：
 
                   9
               /       \
             2  6        12
            /  |  \     /   \
          1   3 5   8  11    13 15
 
 删除11后12只有1个孩子，不合要求，把13提上去，12下来做孩子：
 
                  9
               /      \
             2 6        13
           /  |   \    /   \
          1  3 5  8   12   15
 
 ## B+树
 
 B树的一种变体，有更高的查询性能。k阶B+树特性为：\
 · 每个中间结点都有k个元素，每个元素不保存数据，只用来索引，所有数据都保存在叶子结点
 · 所有叶子结点保存了全部元素的信息，以及指向这些元素记录的指针，各叶子结点按关键字大小顺序连接。
 · 所有中间结点元素都同时存在于子节点，在子节点元素中是最大或最小元素。
 
 举例：
 
                       8         15
                     /              \
                2   5    8           11       15
             /      |      \         /           \
           1  2 ->  3  5 -> 6 8 -> 9  11 ->   13  15    
           
  卫星数据：索引元素指向的数据记录，B树里无论是 **中间结点还是叶子结点都有卫星数据**。B+树**只有叶子结点有卫星数据**。
  
  数据库的聚集索引中，叶子结点直接包含卫星数据。非聚集索引中，叶子结点带有指向卫星数据的指针。
  
  与B树的比较：
  
  · B+树中间结点不存卫星数据，所以同样大小的磁盘页B+树可以存储更多节点元素。即数据量相同的情况下，B+树更矮胖；\
  · B+树的查询必须查找到叶子结点，B树只要找到匹配元素即可，所以B树的查找性能不稳定，B+树每次查找都是稳定的；\
  · B树做范围查询只能用中序遍历，B+树范围查找只需要在链表上做遍历即可。
  
  总结一下，就是：\
  B+树单一节点可以存储更多信息，磁盘IO次数更少；\
  B+树的查询性能更稳定;\
  B+树更方便范围查找
  
  
  
